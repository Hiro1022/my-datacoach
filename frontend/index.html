<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</title>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>

    #drop-area {
      border: 2px dashed #6cb4ee;
      border-radius: 20px;
      width: 80%;
      height: 200px;
      margin: 50px auto;
      text-align: center;
      padding: 20px;
      font-size: 18px;
      color: #666;
      background-color: #f0f8ff;
    }
  </style>
</head>
<body>

  <div id="drop-area">
    ã“ã“ã«CSVã¾ãŸã¯Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ãã ã•ã„
  </div>
  
  <div id="table-area"></div>
  
  <div id="ranking-area" style="display: flex; justify-content: center; gap: 40px; margin-top: 40px;">
    <div id="best-seller-table"></div>
    <div id="worst-seller-table"></div>
  </div>
  
  <div style="width: 100%; margin-top: 40px;">
    <canvas id="sales-chart" width="600" height="400" style="display: block; margin: 20px auto;"></canvas>
  </div>

  


<script>
  const dropArea = document.getElementById('drop-area');

  // ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ã‚‹é–“ã€ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¤‰ãˆã‚‹
  dropArea.addEventListener('dragover', (event) => {
    event.preventDefault();
    dropArea.style.backgroundColor = '#e0f7fa';
  });

  // ãƒ‰ãƒ©ãƒƒã‚°è§£é™¤ã—ãŸã¨ãã«ã‚¹ã‚¿ã‚¤ãƒ«æˆ»ã™
  dropArea.addEventListener('dragleave', (event) => {
    event.preventDefault();
    dropArea.style.backgroundColor = '#f0f8ff';
  });

  // ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ‰ãƒ­ãƒƒãƒ—ã•ã‚ŒãŸæ™‚ã®å‡¦ç†
  dropArea.addEventListener('drop', (event) => {
    event.preventDefault();
    dropArea.style.backgroundColor = '#f0f8ff';

    const files = event.dataTransfer.files;
if (files.length > 0) {
  const file = files[0];

  const reader = new FileReader();
  reader.onload = function(e) {
    const data = new Uint8Array(e.target.result);
    const workbook = XLSX.read(data, { type: 'array' });

    const firstSheetName = workbook.SheetNames[0];
    const worksheet = workbook.Sheets[firstSheetName];
    const jsonData = XLSX.utils.sheet_to_json(worksheet);

    console.log('èª­ã¿è¾¼ã‚“ã ãƒ‡ãƒ¼ã‚¿:', jsonData);
    // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œã‚‹é–¢æ•°
function createTableFromJson(jsonData) {
  const tableArea = document.getElementById('table-area');

  let html = '<table border="1" style="width:80%; margin:20px auto; border-collapse:collapse;">';
  html += '<tr>';

  // æœ€åˆã®ãƒ‡ãƒ¼ã‚¿ã®ã‚­ãƒ¼ã‚’ä½¿ã£ã¦ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä½œã‚‹
  const headers = Object.keys(jsonData[0]);
  headers.forEach(header => {
    html += `<th>${header}</th>`;
  });
  html += '</tr>';

  // ãƒ‡ãƒ¼ã‚¿ã‚’1è¡Œãšã¤ä½œã‚‹
  jsonData.forEach(row => {
    html += '<tr>';
    headers.forEach(header => {
      html += `<td>${row[header]}</td>`;
    });
    html += '</tr>';
  });

  html += '</table>';

  tableArea.innerHTML = html;
}

// ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿å¾Œã«å‘¼ã³å‡ºã™ï¼
createTableFromJson(jsonData);
createChartFromJson(jsonData);
createRankingTables(jsonData);
createStockRiskReport(jsonData);
createAdviceMessages(jsonData);




// ã‚°ãƒ©ãƒ•ã‚’ä½œã‚‹é–¢æ•°
function createChartFromJson(jsonData) {
  const ctx = document.getElementById('sales-chart').getContext('2d');

  // å•†å“åãƒªã‚¹ãƒˆ
  const labels = jsonData.map(item => item['å•†å“å']);
  // å£²ä¸Šæ•°ãƒªã‚¹ãƒˆ
  const sales = jsonData.map(item => item['å£²ä¸Šæ•°']);

  new Chart(ctx, {
    type: 'bar', // æ£’ã‚°ãƒ©ãƒ•
    data: {
      labels: labels,
      datasets: [{
        label: 'å£²ä¸Šæ•°',
        data: sales,
        backgroundColor: 'rgba(54, 162, 235, 0.5)', // å¯’è‰²ãƒ™ãƒ¼ã‚¹ï¼
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
}


  };
  reader.readAsArrayBuffer(file);
}
// ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ã‚’ä½œã‚‹é–¢æ•°
function createRankingTables(jsonData) {
  const tableArea = document.getElementById('table-area');

  // å…ƒãƒ‡ãƒ¼ã‚¿ã‚’å£Šã•ãªã„ã‚ˆã†ã«ã‚³ãƒ”ãƒ¼ã—ã¦ä¸¦ã³æ›¿ãˆ
  const bestSellers = [...jsonData].sort((a, b) => b['å£²ä¸Šæ•°'] - a['å£²ä¸Šæ•°']);
  const worstSellers = [...jsonData].sort((a, b) => a['å£²ä¸Šæ•°'] - b['å£²ä¸Šæ•°']);

  let html = '';

  // å£²ã‚Œç­‹ãƒ©ãƒ³ã‚­ãƒ³ã‚°
  html += '<h2 style="text-align:center;">å£²ã‚Œç­‹ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>';
  html += '<table border="1" style="width:60%; margin:10px auto; border-collapse:collapse;">';
  html += '<tr><th>é †ä½</th><th>å•†å“å</th><th>å£²ä¸Šæ•°</th></tr>';
  bestSellers.forEach((item, index) => {
    html += `<tr><td>${index + 1}</td><td>${item['å•†å“å']}</td><td>${item['å£²ä¸Šæ•°']}</td></tr>`;
  });
  html += '</table>';

  // æ­»ã«ç­‹ãƒ©ãƒ³ã‚­ãƒ³ã‚°
  html += '<h2 style="text-align:center;">æ­»ã«ç­‹ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>';
  html += '<table border="1" style="width:60%; margin:10px auto; border-collapse:collapse;">';
  html += '<tr><th>é †ä½</th><th>å•†å“å</th><th>å£²ä¸Šæ•°</th></tr>';
  worstSellers.forEach((item, index) => {
    html += `<tr><td>${index + 1}</td><td>${item['å•†å“å']}</td><td>${item['å£²ä¸Šæ•°']}</td></tr>`;
  });
  html += '</table>';

  tableArea.innerHTML += html; // += ã§ä»Šã‚ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¿½åŠ ï¼
}
function createRankingTables(jsonData) {
  const bestSellers = [...jsonData].sort((a, b) => b['å£²ä¸Šæ•°'] - a['å£²ä¸Šæ•°']);
  const worstSellers = [...jsonData].sort((a, b) => a['å£²ä¸Šæ•°'] - b['å£²ä¸Šæ•°']);

  // å£²ã‚Œç­‹ãƒ©ãƒ³ã‚­ãƒ³ã‚°HTML
  let bestHtml = '<h2 style="text-align:center;">å£²ã‚Œç­‹ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>';
  bestHtml += '<table border="1" style="width:100%; border-collapse:collapse;">';
  bestHtml += '<tr><th>é †ä½</th><th>å•†å“å</th><th>å£²ä¸Šæ•°</th></tr>';
  bestSellers.forEach((item, index) => {
    bestHtml += `<tr><td>${index + 1}</td><td>${item['å•†å“å']}</td><td>${item['å£²ä¸Šæ•°']}</td></tr>`;
  });
  bestHtml += '</table>';

  // æ­»ã«ç­‹ãƒ©ãƒ³ã‚­ãƒ³ã‚°HTML
  let worstHtml = '<h2 style="text-align:center;">æ­»ã«ç­‹ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>';
  worstHtml += '<table border="1" style="width:100%; border-collapse:collapse;">';
  worstHtml += '<tr><th>é †ä½</th><th>å•†å“å</th><th>å£²ä¸Šæ•°</th></tr>';
  worstSellers.forEach((item, index) => {
    worstHtml += `<tr><td>${index + 1}</td><td>${item['å•†å“å']}</td><td>${item['å£²ä¸Šæ•°']}</td></tr>`;
  });
  worstHtml += '</table>';

  // ãã‚Œãã‚Œã®divã«æ›¸ãè¾¼ã‚€ï¼
  document.getElementById('best-seller-table').innerHTML = bestHtml;
  document.getElementById('worst-seller-table').innerHTML = worstHtml;
}
// åœ¨åº«ãƒªã‚¹ã‚¯ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦è¡¨ç¤ºã™ã‚‹é–¢æ•°
function createStockRiskReport(jsonData) {
  const tableArea = document.getElementById('table-area');

  let riskHtml = '<h2 style="text-align:center; margin-top: 40px;">åœ¨åº«ãƒªã‚¹ã‚¯ãƒ¬ãƒãƒ¼ãƒˆ</h2>';

  // éå‰°åœ¨åº«ãƒªã‚¹ãƒˆ
  const overstockItems = jsonData.filter(item => item['åœ¨åº«æ•°'] >= item['å£²ä¸Šæ•°'] * 2);

  // æ¬ å“ãƒªã‚¹ã‚¯ãƒªã‚¹ãƒˆ
  const shortageItems = jsonData.filter(item => item['åœ¨åº«æ•°'] <= item['å£²ä¸Šæ•°'] * 0.5);

  riskHtml += '<div style="display: flex; justify-content: center; gap: 40px;">';

  // éå‰°åœ¨åº«ãƒ†ãƒ¼ãƒ–ãƒ«
  riskHtml += '<div><h3 style="text-align:center;">åœ¨åº«éå‰°ãƒªã‚¹ã‚¯</h3>';
  riskHtml += '<table border="1" style="width:100%; border-collapse:collapse;">';
  riskHtml += '<tr><th>å•†å“å</th><th>å£²ä¸Šæ•°</th><th>åœ¨åº«æ•°</th></tr>';
  overstockItems.forEach(item => {
    riskHtml += `<tr><td>${item['å•†å“å']}</td><td>${item['å£²ä¸Šæ•°']}</td><td>${item['åœ¨åº«æ•°']}</td></tr>`;
  });
  riskHtml += '</table></div>';

  // æ¬ å“ãƒªã‚¹ã‚¯ãƒ†ãƒ¼ãƒ–ãƒ«
  riskHtml += '<div><h3 style="text-align:center;">æ¬ å“ãƒªã‚¹ã‚¯</h3>';
  riskHtml += '<table border="1" style="width:100%; border-collapse:collapse;">';
  riskHtml += '<tr><th>å•†å“å</th><th>å£²ä¸Šæ•°</th><th>åœ¨åº«æ•°</th></tr>';
  shortageItems.forEach(item => {
    riskHtml += `<tr><td>${item['å•†å“å']}</td><td>${item['å£²ä¸Šæ•°']}</td><td>${item['åœ¨åº«æ•°']}</td></tr>`;
  });
  riskHtml += '</table></div>';

  riskHtml += '</div>';

  tableArea.innerHTML += riskHtml;
}
// è‡ªç„¶è¨€èªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ä½œæˆã—ã¦è¡¨ç¤ºã™ã‚‹é–¢æ•°
function createAdviceMessages(jsonData) {
  const tableArea = document.getElementById('table-area');

  let adviceHtml = '<h2 style="text-align:center; margin-top: 40px;">AIã‚¢ãƒ‰ãƒã‚¤ã‚¹</h2><ul style="width:80%; margin: 20px auto; font-size:18px;">';

  // æ¬ å“ãƒªã‚¹ã‚¯ã®å•†å“
  const shortageItems = jsonData.filter(item => item['åœ¨åº«æ•°'] <= item['å£²ä¸Šæ•°'] * 0.5);
  shortageItems.forEach(item => {
    adviceHtml += `<li>âš ï¸ ã€Œ${item['å•†å“å']}ã€ã¯å£²ä¸Šæ•°ã«å¯¾ã—ã¦åœ¨åº«ãŒã‹ãªã‚Šå°‘ãªã„ã§ã™ã€‚è¿½åŠ ç™ºæ³¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚</li>`;
  });

  // åœ¨åº«éå‰°ãƒªã‚¹ã‚¯ã®å•†å“
  const overstockItems = jsonData.filter(item => item['åœ¨åº«æ•°'] >= item['å£²ä¸Šæ•°'] * 2);
  overstockItems.forEach(item => {
    adviceHtml += `<li>ğŸ“¦ ã€Œ${item['å•†å“å']}ã€ã¯å£²ä¸Šã«æ¯”ã¹åœ¨åº«ãŒéå‰°ã§ã™ã€‚è²©å£²ä¿ƒé€²ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’æ¤œè¨ã—ã¦ã‚‚ã„ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚</li>`;
  });

  adviceHtml += '</ul>';

  tableArea.innerHTML += adviceHtml;
}



  });
</script>

</body>
</html>


